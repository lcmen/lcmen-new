<!DOCTYPE html>
<html lang="en-US">
  <head>
    <title>HSTS with Rails - Lucas Mendelowski</title>

    <meta charset="utf-8" />
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" />
    <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport" />
    <meta name="description" content="Enforce requests over HTTPS with Ruby on Rails" />
    <meta name="turbo-cache-control">

    <meta property="og:title" content="HSTS with Rails - Lucas Mendelowski" />
    <meta property="og:description" content="Enforce requests over HTTPS with Ruby on Rails" />
    <meta property="og:image" content="https://www.mendelowski.com/assets/img/social.png" />
    <meta property="og:locale" content="en_US" />
    <meta property="og:url" content="https://www.mendelowski.com" />
    <meta property="og:site_name" content="Lucas Mendelowski" />

    <meta name="twitter:title" content="HSTS with Rails - Lucas Mendelowski" />
    <meta name="twitter:description" content="Enforce requests over HTTPS with Ruby on Rails" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:creator" content="lcmen_" />
    <meta name="twitter:site" content="lcmen_" />
    <meta name="twitter:image" content="https://www.mendelowski.com/assets/img/social.png" />

    <link rel="canonical" href="https://www.mendelowski.com/til/2019/08/hsts-with-rails" />
    <link rel="icon" type="image/png" href="/assets/img/favicon.png" />
    <link crossorigin="crossorigin" href="https://fonts.gstatic.com" rel="preconnect" />
    <link crossorigin="crossorigin" href="https://unpkg.com" rel="preconnect" />
    <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" />
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" /></noscript>
    <link rel="stylesheet" href="https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css">
    <link rel="stylesheet" href="/assets/css/main.css" media="screen" data-turbo-track="reload">
    <script src="/assets/js/main.js" data-turbo-track="reload"></script>
    <script src="https://unpkg.com/@hotwired/turbo" defer></script>
  </head>
  <body>
    <div id="main">
      <header id="header" class="container mx-auto" data-turbo-permanent>
  <div class="flex items-center justify-between py-6 lg:py-10">
    <a href="/" class="flex items-center" aria-label="Homepage">
      <img src="/assets/img/logo.svg" width="44" height="36" alt="logo" />
    </a>
    <div class="flex items-center lg:hidden">
      <button id="menu" class="group z-50" aria-label="Mobile menu">
        <svg
          width="24"
          height="15"
          xmlns="http://www.w3.org/2000/svg"
          class="relative z-50 fill-current text-primary transition-transform group-[.active]:fill-white group-[.active]:rotate-90"
        >
          <g fill-rule="evenodd">
            <rect width="24" height="3" />
            <rect y="6" width="24" height="3" />
            <rect y="12" width="24" height="3" />
          </g>
        </svg>
      </button>
      <nav class="pointer-events-none fixed inset-0 z-30 flex bg-black bg-opacity-80 opacity-0 transition-opacity lg:hidden duration-300">
        <div class="ml-auto w-2/3 bg-green p-4 md:w-1/3">
          <ul class="mt-8 flex flex-col">
            <li>
              <a
                href="/"
                class="mb-3 block px-2 font-body text-lg font-medium text-white"
                aria-label="Intro"
              >Intro</a>
            </li>

            <li>
              <a
                href="/blog/"
                class="mb-3 block px-2 font-body text-lg font-medium text-white"
                aria-label="Blog"
              >Blog</a>
            </li>

            <li>
              <a
                href="/til/"
                class="mb-3 block px-2 font-body text-lg font-medium text-white"
                aria-label="Today I Learned"
              >Til</a>
            </li>

            <li>
              <a
                href="/uses/"
                class="mb-3 block px-2 font-body text-lg font-medium text-white"
                aria-label="Uses"
              >Uses</a>
            </li>

            <li>
              <a
                href="/contact/"
                class="mb-3 block px-2 font-body text-lg font-medium text-white"
                aria-label="Contact"
              >Contact</a>
            </li>
          </ul>
        </div>
      </nav>
    </div>
    <div class="hidden lg:block">
      <ul class="flex items-center">
        <li class="group relative mr-6 mb-1">
          <div class="absolute left-0 bottom-0 z-20 h-0 w-full opacity-75 transition-all group-hover:h-2 group-hover:bg-yellow">
          </div>
          <a
            href="/"
            class="relative z-30 block px-2 font-body text-lg font-medium text-primary transition-colors group-hover:text-green"
            aria-label="Intro"
          >Intro</a>
        </li>

        <li class="group relative mr-6 mb-1">
          <div class="absolute left-0 bottom-0 z-20 h-0 w-full opacity-75 transition-all group-hover:h-2 group-hover:bg-yellow">
          </div>
          <a
            href="/blog/"
            class="relative z-30 block px-2 font-body text-lg font-medium text-primary transition-colors group-hover:text-green"
            aria-label="Blog"
          >Blog</a>
        </li>

        <li class="group relative mr-6 mb-1">
          <div class="absolute left-0 bottom-0 z-20 h-0 w-full opacity-75 transition-all group-hover:h-2 group-hover:bg-yellow">
          </div>
          <a
            href="/til/"
            class="relative z-30 block px-2 font-body text-lg font-medium text-primary transition-colors group-hover:text-green"
            aria-label="Today I Learned"
          >Til</a>
        </li>

        <li class="group relative mr-6 mb-1">
          <div class="absolute left-0 bottom-0 z-20 h-0 w-full opacity-75 transition-all group-hover:h-2 group-hover:bg-yellow">
          </div>
          <a
            href="/uses/"
            class="relative z-30 block px-2 font-body text-lg font-medium text-primary transition-colors group-hover:text-green"
            aria-label="Uses"
          >Uses</a>
        </li>

        <li class="group relative mr-6 mb-1">
          <div class="absolute left-0 bottom-0 z-20 h-0 w-full opacity-75 transition-all group-hover:h-2 group-hover:bg-yellow">
          </div>
          <a
            href="/contact/"
            class="relative z-30 block px-2 font-body text-lg font-medium text-primary transition-colors group-hover:text-green"
            aria-label="Contact"
          >Contact</a>
        </li>
      </ul>
    </div>
  </div>
</header>


      <div>
        <div class="container mx-auto">
          <article class="mb-8">
  <p class="mb-4">
    
      <span class="inline-block rounded-full bg-secondary px-2 py-1 font-body text-sm text-white">
  #ruby
</span>

    
      <span class="inline-block rounded-full bg-secondary px-2 py-1 font-body text-sm text-white">
  #rails
</span>

    
  </p>
  <h2 class="block font-body text-3xl font-semibold leading-tight text-primary transition-colors">
    HSTS with Rails
  </h2>
  <div class="flex items-center gap-2 py-4 font-body text-grey">
    <p class="font-light">
      August 26, 2019
    </p>
    <span>//</span>
    <p class="font-light">
      1 min read
    </p>
  </div>
  <content class="prose prose max-w-none">
    <h1 id="hsts-with-rails">HSTS with Rails</h1>

<p><strong>TL;DR</strong> HSTS tells browsers to always make requests over HTTPS to HSTS sites.</p>

<p>HSTS (HTTP Strict Transport Security) is a mechanism for preventing man-in-the-middle attack known as SSL Stripping. Such attack relies on hijacking browser connection to use <code class="language-plaintext highlighter-rouge">http</code> instead of <code class="language-plaintext highlighter-rouge">https</code> for communication with the server. Using <code class="language-plaintext highlighter-rouge">Strict-Transport-Security</code> header we can declare that browser should communicate with <code class="language-plaintext highlighter-rouge">https</code> only and specify a period of time for such behavior.</p>

<p>Example of attack from <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Strict-Transport-Security">MDN docs</a>:</p>

<blockquote>
  <p>You log into a free WiFi access point at an airport and start surfing the web, visiting your online banking service to check your balance and pay a couple of bills. Unfortunately, the access point you’re using is actually a hacker’s laptop, and they’re intercepting your original HTTP request and redirecting you to a clone of your bank’s site instead of the real thing. Now your private data is exposed to the hacker.</p>

  <p>Strict Transport Security resolves this problem; as long as you’ve accessed your bank’s web site once using HTTPS, and the bank’s web site uses Strict Transport Security, your browser will know to automatically use only HTTPS, which prevents hackers from performing this sort of man-in-the-middle attack.</p>
</blockquote>

<p>HSTS can be enabled by switching <code class="language-plaintext highlighter-rouge">force_ssl</code> option in the application’s config:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># config/environment/production.rb</span>

<span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">configure</span> <span class="k">do</span>
  <span class="o">...</span>

  <span class="n">config</span><span class="p">.</span><span class="nf">force_ssl</span> <span class="o">=</span> <span class="kp">true</span>

  <span class="o">...</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Setting <code class="language-plaintext highlighter-rouge">force_ssl</code> to <code class="language-plaintext highlighter-rouge">true</code>, inserts
<a href="https://api.rubyonrails.org/classes/ActionDispatch/SSL.html">ActionDispatch::SSL</a> middleware which is responsible for 3 things:</p>

<ol>
  <li>Redirecting <code class="language-plaintext highlighter-rouge">http</code> requests to <code class="language-plaintext highlighter-rouge">https</code></li>
  <li>Adding <code class="language-plaintext highlighter-rouge">HSTS</code> header to the response</li>
  <li>Set <code class="language-plaintext highlighter-rouge">secure</code> flag on cookies to send them through <code class="language-plaintext highlighter-rouge">https</code> only</li>
</ol>

  </content >
</article>

        </div>
      </div>

      <footer id="footer" class="container mx-auto">
  <div class="flex flex-col items-center justify-between border-t border-grey-lighter py-10 sm:flex-row sm:py-12">
    <p class="font-body font-light text-primary">
      &copy; 2023 Lucas Mendelowski
    </p>
    <div class="flex items-center pt-5 gap-5 sm:pt-0">
      
        <a href="https://github.com/lcmen" target="_blank" aria-label="github">
          <i class="text-4xl text-primary hover:text-secondary transition-colors bx bxl-github"></i>
        </a>
      
        <a href="https://www.linkedin.com/in/lucasmendelowski/" target="_blank" aria-label="linkedin">
          <i class="text-4xl text-primary hover:text-secondary transition-colors bx bxl-linkedin"></i>
        </a>
      
        <a href="https://twitter.com/lcmen_" target="_blank" aria-label="twitter">
          <i class="text-4xl text-primary hover:text-secondary transition-colors bx bxl-twitter"></i>
        </a>
      
    </div>
  </div>
</footer>

    </div>
  </body>
</html>
